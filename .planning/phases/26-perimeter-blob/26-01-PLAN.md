---
phase: 26-perimeter-blob
plan: 01
type: execute
---

<objective>
Add SVG goo filter and integrate soft-body physics hook into GameBoard.

Purpose: Connect Phase 25's physics foundation to the rendering layer, enabling soft-body blobs to be drawn alongside existing goop rendering.
Output: GameBoard renders soft-body blobs with goo filter, physics hook called from game loop.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@.planning/phases/26-perimeter-blob/26-01-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (dependency graph):
@.planning/phases/25-physics-foundation/25-01-SUMMARY.md
@.planning/phases/25-physics-foundation/25-02-SUMMARY.md

# Key source files:
@src/core/softBody/index.ts
@src/core/softBody/types.ts
@src/core/softBody/blobFactory.ts
@src/hooks/useSoftBodyPhysics.ts
@src/components/GameBoard.tsx
@src/hooks/useGameEngine.ts

**Tech stack available:**
- Verlet physics engine (stepPhysics, applyPressure, etc.)
- Blob factory (createBlobFromCells with perimeter tracing)
- useSoftBodyPhysics hook (lifecycle management)

**Established patterns:**
- Physics runs in flat pixel space (cylindrical projection is rendering-only)
- Physics hook uses refs to avoid re-renders
- step() called externally from game loop

**Constraining decisions:**
- Phase 25: Inner vertices use 10x home stiffness for stability
- Phase 25: Cross springs only between vertices < 1.5 cells apart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add SVG goo filter definition</name>
  <files>src/components/GameBoard.tsx</files>
  <action>
Add the SVG goo filter to GameBoard's defs section. This filter creates the "gooey" merging effect.

In the existing `<defs>` block (around line 150), add:

```tsx
{/* Soft-body goo filter - creates blobby merge effect */}
<filter id="goo-filter" colorInterpolationFilters="sRGB">
  <feGaussianBlur in="SourceGraphic" stdDeviation="8" result="blur" />
  <feColorMatrix
    in="blur"
    mode="matrix"
    values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 20 -12"
    result="goo"
  />
  <feComposite in="SourceGraphic" in2="goo" operator="atop" />
</filter>
```

Parameters explained:
- stdDeviation="8": Blur radius in pixels
- alphaMultiplier=20, alphaOffset=-12: Creates sharp-ish edges with gooey connections
- operator="atop": Composites original over blurred for clean edges

Do NOT apply the filter to anything yet - just define it. Mobile may need this disabled.
  </action>
  <verify>Build succeeds: `npm run build` passes without errors</verify>
  <done>Goo filter defined in GameBoard defs section, ready for use</done>
</task>

<task type="auto">
  <name>Task 2: Integrate physics hook into GameBoard</name>
  <files>src/components/GameBoard.tsx, src/hooks/useGameEngine.ts</files>
  <action>
Add the soft-body physics hook to GameBoard and call step() from the game loop.

**In GameBoard.tsx:**

1. Import the hook:
```tsx
import { useSoftBodyPhysics } from '../hooks/useSoftBodyPhysics';
```

2. Call the hook inside GameBoard component (near other hooks):
```tsx
// Soft-body physics for goop rendering (Phase 26)
const softBodyPhysics = useSoftBodyPhysics({
  enabled: !isMobile,  // Desktop only for now
});
```

3. Add a ref to track if we need to re-render for soft-body updates:
```tsx
const softBodyTickRef = useRef(0);
```

**In useGameEngine.ts:**

1. Add a callback parameter for physics step:
```tsx
// In the hook's options or as a parameter:
onPhysicsStep?: (dt: number) => void;
```

2. In the game loop (around line 85), call the physics step:
```tsx
// After engine.tick(dt):
if (onPhysicsStep) {
  onPhysicsStep(dt / 1000); // Convert ms to seconds
}
```

**Back in GameBoard.tsx:**

3. Pass the step callback to useGameEngine:
```tsx
const { engine } = useGameEngine({
  // ... existing options
  onPhysicsStep: softBodyPhysics.step,
});
```

This keeps physics in sync with the game loop without creating a separate RAF loop.

**Important:** Do NOT render soft-body blobs yet. This task only sets up the infrastructure.
  </action>
  <verify>
1. `npm run test:run` - all 194 tests pass
2. `npm run build` - no TypeScript errors
3. Dev server runs without console errors
  </verify>
  <done>
- useSoftBodyPhysics hook integrated into GameBoard
- Physics step called from game loop via callback
- No visual changes yet (rendering comes in 26-02)
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run test:run` passes all tests (194+)
- [ ] Dev server runs without console errors
- [ ] No visual changes to game (this is infrastructure only)
</verification>

<success_criteria>
- SVG goo filter defined in GameBoard defs
- useSoftBodyPhysics hook integrated into GameBoard
- Physics step called from game loop
- All tests passing
- No errors or warnings introduced
</success_criteria>

<output>
After completion, create `.planning/phases/26-perimeter-blob/26-01-SUMMARY.md`:

# Phase 26 Plan 01: Goo Filter & Physics Integration Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 26-02-PLAN.md (soft-body blob rendering)
</output>
